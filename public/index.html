<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TradeXinvest</title>
  <link rel="stylesheet" href="style.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  />
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <style>
    .testimonials-section {
      max-width: 900px;
      margin: 2rem auto;
      padding: 0 1rem;
      font-family: Arial, sans-serif;
    }
    .testimonials-container {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      justify-content: center;
    }
    .testimonial-box {
      background: #f9f9f9;
      border-radius: 8px;
      padding: 1.5rem;
      flex: 1 1 280px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      position: relative;
    }
    .testimonial-box p {
      font-size: 1.1rem;
      color: #555;
      margin: 1rem 0 0.8rem;
    }
    .testimonial-box h4 {
      color: #555;
      font-weight: 600;
      margin: 0;
    }
    .stars {
      font-size: 1.3rem;
      color: #f5a623; /* gold star color */
      user-select: none;
    }
    .stars span {
      letter-spacing: 2px;
    }
    .profile-info {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }
    .profile-info img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #ddd;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }
    .profile-info h3 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 600;
    }
    /* Hide withdraw form by default */
    .withdraw-form.hidden {
      display: none;
    }
    /* Chat widget styles */
    .chat-widget {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 300px;
      max-height: 400px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      font-family: Arial, sans-serif;
      display: none; /* hidden by default */
      z-index: 10000;
    }
    .chat-header {
      background: #007bff;
      color: white;
      padding: 10px;
      font-weight: bold;
      border-radius: 8px 8px 0 0;
      cursor: pointer;
    }
    .chat-body {
      flex-grow: 1;
      padding: 10px;
      overflow-y: auto;
      background: #f9f9f9;
    }
    .message {
      margin-bottom: 8px;
      padding: 6px 10px;
      border-radius: 12px;
      max-width: 80%;
      word-wrap: break-word;
    }
    .message.user {
      background: #d1e7dd;
      align-self: flex-end;
    }
    .message.admin {
      background: #f8d7da;
      align-self: flex-start;
    }
    .message.system {
      background: #e2e3e5;
      font-style: italic;
      color: #555;
      align-self: center;
      max-width: 90%;
    }
    #chatForm {
      display: flex;
      border-top: 1px solid #ddd;
    }
    #chatInput {
      flex-grow: 1;
      border: none;
      padding: 10px;
      font-size: 1rem;
      border-radius: 0 0 0 8px;
      outline: none;
    }
    #chatForm button {
      border: none;
      background: #007bff;
      color: white;
      padding: 0 20px;
      cursor: pointer;
      border-radius: 0 0 8px 0;
    }
    :root{
    --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#9ca3af; --brand:#22c55e; --danger:#ef4444;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .container{max-width:1100px;margin:0 auto;padding:24px}
  .grid{display:grid;gap:16px}
  .two{grid-template-columns:1fr 1fr}
  .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.2)}
  h1,h2,h3{margin:.4em 0}
  input,select,button,textarea{
    width:100%;padding:12px 14px;border-radius:12px;border:1px solid #253041;background:#0b1220;color:var(--text);
    outline:none
  }
  input::placeholder{color:#6b7280}
  button{cursor:pointer;transition:transform .05s ease, opacity .15s ease}
  button:hover{opacity:.95}
  .btn{background:#1f2937}
  .btn-primary{background:var(--brand);color:#052e16;border:none}
  .btn-danger{background:var(--danger);border:none}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .row>.grow{flex:1}
  .muted{color:var(--muted);font-size:.9rem}
  .hidden{display:none !important}

  /* Overlay + Modal */
  #overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);backdrop-filter: blur(2px);z-index:1000}
  .modal{display:none;position:fixed;inset:auto;top:50%;left:50%;transform:translate(-50%,-50%);
    background:#0b1220;border:1px solid #26334d;border-radius:16px;padding:20px;z-index:1001;min-width:min(92vw,520px)}
  .modal h3{margin-top:0}
  .modal .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px}

  /* Tables */
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid #1f2937;text-align:left}
  th{color:#9ca3af;font-weight:600}

  /* Header */
  .topbar{position:sticky;top:0;background:rgba(15,23,42,.7);backdrop-filter:blur(6px);border-bottom:1px solid #1f2937;z-index:50}
  .topbar-inner{display:flex;align-items:center;justify-content:space-between;padding:12px 24px}
  .brand{font-weight:700;letter-spacing:.3px}
  .pill{padding:6px 10px;border-radius:999px;background:#0b1220;border:1px solid #1f2937}

  /* Stat cards */
  .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  .stat{background:#0b1220;border:1px solid #1f2937;border-radius:14px;padding:16px}
  .stat .label{color:#94a3b8;font-size:.9rem}
  .stat .value{font-size:1.4rem;font-weight:700;margin-top:6px}

  /* Sliders */
  #welcomeNote img{display:none;width:100%;max-height:180px;object-fit:cover;border-radius:12px;border:1px solid #1f2937}
  #welcomeNote img.active{display:block}
  #quotes p{display:none;font-style:italic;margin:0}
  #quotes p.active{display:block}

  /* Admin tabs */
  .tabs{display:flex;gap:8px;margin-bottom:10px}
  .tabs button{padding:8px 12px;border-radius:10px}
  .tabs button.active{background:#19324f}

  /* Tiny helper */
  .right{float:right}
  #dashboardSection {
  display: none;
}
#termsModal, #twoFAModal {
  display: none;
}
/* CSS */
/* #adminLoginModal {
  display: none;
}
#adminLoginModal.active {
  display: block;
} */


  </style>
</head>
<body>
  <div class="lowerNAV" onclick="toggleMobileNav()">
    <div style="display: flex; flex-direction: column; gap: 4px;">
      <span style="width: 30px; height: 4px; background-color: black;"></span>
      <span style="width: 30px; height: 4px; background-color: black;"></span>
      <span style="width: 30px; height: 4px; background-color: black;"></span>
    </div>
  </div>

  <ul class="mobile-menu" id="mobileMenu">
    <li><a href="index.html">Home</a></li>
    <li><a href="about.html">About Us</a></li>
    <li><a href="contact.html">Contact</a></li>
  </ul> 
   <div class="nav">
    <p class="logo">TradeXInvest</p>
    

    </div>
    

<!-- end of dashboard -->
 <!-- Topbar -->
<div class="topbar">
  <div class="topbar-inner container">
    <div class="brand">TradexInvest</div>
    <div class="row">
      <button id="openLogin" class="pill">Login</button>
      <button id="openSignup" class="pill">Sign Up</button>
      <button id="openDashboard" class="pill hidden">Dashboard</button>
      <button id="openAdminLogin" class="pill ">Admin</button>
      <button id="logoutTop" class="pill hidden">Logout</button>
      
    </div>
  </div>
</div>
  <div class="card">
      <h3>Welcome</h3>
      <div id="welcomeNote">
        <img src="https://picsum.photos/seed/a/1100/280" class="active" alt="">
        <img src="https://picsum.photos/seed/b/1100/280" alt="">
        <img src="https://picsum.photos/seed/c/1100/280" alt="">
      </div>
      <div style="margin-top:12px" id="quotes">
        <p class="active">“Invest smart, live better.”</p>
        <p>“Your future starts today.”</p>
        <p>“Profit is a journey, not a destination.”</p>
      </div>
    </div>

<div class="container grid two">

  <!-- Public / left column -->
  <div class="grid">
    <div class="card">
      <h2>Get started</h2>
      <p class="muted">Create an account, log in, accept the terms, verify 2FA, then manage your investments — all on this page.</p>
      <div class="row">
        <button id="ctaSignup" class="btn btn-primary">Create account</button>
        <button id="ctaLogin" class="btn">I already have an account</button>
      </div>
    </div>
</div>
    

  <!-- Dashboard / right column -->
  <div class="grid">
    <!-- ================= Admin Dashboard ================= -->
<div id="adminDashboard" class="card hidden">
  <h2>Admin Dashboard</h2>
  <button id="logoutAdmin" class="btn">Logout</button>

  <!-- Tabs -->
  <div class="tabs">
    <button data-tab="usersTab" class="btn active">Users</button>
    <button data-tab="withdrawalsTab" class="btn">Withdrawals</button>
  </div>

  <!-- Users Tab -->
  <div id="usersTab">
    <h3>Manage Users</h3>
    <table>
      <thead>
        <tr>
          <th>Name</th><th>Email</th><th>Balance</th><th>Profit</th><th>Interest</th><th>Actions</th>
        </tr>
      </thead>
      <tbody id="adminUsersBody"></tbody>
    </table>
  </div>

  <!-- Withdrawals Tab -->
  <div id="withdrawalsTab" class="hidden">
    <h3>Manage Withdrawals</h3>
    <table>
      <thead>
        <tr>
          <th>User</th><th>Method</th><th>Amount</th><th>Status</th><th>Actions</th>
        </tr>
      </thead>
      <tbody id="adminWdBody"></tbody>
    </table>
  </div>
</div>

<!-- ================= Edit User Modal ================= -->
<div id="editUserModal" class="modal hidden">
  <div class="modal-content">
    <h3>Edit User</h3>
    <label>Name <input type="text" id="editName" /></label>
    <label>Email <input type="email" id="editEmail" /></label>
    <label>Balance <input type="number" id="editBalance" /></label>
    <label>Profit <input type="number" id="editProfit" /></label>
    <label>Interest <input type="number" id="editInterest" /></label>
    <button id="saveUserBtn" class="btn">Save</button>
    <button onclick="closeModal('editUserModal')" class="btn">Cancel</button>
  </div>
</div>

    
  </div>
</div>

<!-- ===== Overlay + Modals ===== -->
<div id="overlay"></div>

<!-- Signup Modal -->
<div id="signupModal" class="modal">
  <h3>Create account</h3>
  <div class="row">
    <input id="suName" placeholder="Full name" class="grow" />
    <input id="suEmail" placeholder="Email" class="grow" />
  </div>
  <div class="row" style="margin-top:10px">
    <input id="suPassword" placeholder="Password" type="password" class="grow" />
  </div>
  <div class="actions">
    <button class="btn" data-close="signupModal">Cancel</button>
    <button id="signupSubmit" class="btn btn-primary">Sign Up</button>
  </div>
</div>
<!-- Admin Login Button (hidden for regular users) -->

<div id="adminLoginModal" class="modal ">
  <h3>Admin Login</h3>
  <input id="adminEmail" type="email" placeholder="Admin Email" />
  <input id="adminPassword" type="password" placeholder="Password" />
  <button id="adminLoginSubmit">Login</button>
  <button onclick="closeModal('adminLoginModal')">Cancel</button>
</div>

<!-- Login Modal -->
<div id="loginModal" class="modal">
  <h3>Login</h3>
  <input type="email" id="liEmail" placeholder="Email" />
  <div style="height:8px"></div>
  <input  id="liPassword" placeholder="Password" type="password" />
  <input type="hidden" id="loginType" value="admin"> 
  <div class="actions">
    <button class="btn" data-close="loginModal">Cancel</button>
    <button id="loginSubmit" class="btn btn-primary">Login</button>
  </div>
</div>

<!-- Terms Modal -->
<!-- Terms Modal -->
<div id="termsModal" class="modal">
  <h3>Terms & Conditions</h3>
  <div style="max-height:220px;overflow:auto;border:1px solid #1f2937;border-radius:10px;padding:12px">
    <p class="muted">By continuing, you agree to our terms regarding investments, risk disclosure, and platform policies.</p>
    <ul class="muted">
      <li>Investments involve risk of loss.</li>
      <li>Profits shown are indicative and not guaranteed.</li>
      <li>We may require identity verification for withdrawals.</li>
    </ul>
  </div>
  <div class="actions">
    <button class="btn" data-close="termsModal">Decline</button>
    <button id="acceptTerms" class="btn btn-primary">I Accept</button>
  </div>
</div>

<!-- 2FA Modal -->
<div id="twoFAModal" class="modal">
  <h3>Two-Factor Verification</h3>
  <p class="muted" id="twofaHint">We’ve emailed a 6-digit code to your address.</p>
  <input id="twofaCode" placeholder="Enter 2FA code" />
  <div class="row" style="align-items:center;margin-top:8px">
    <div id="countdown" class="muted">Code expires in 5:00</div>
    <button id="resend2FA" class="btn right">Resend code</button>
  </div>
  <div class="actions">
    <button class="btn" data-close="twoFAModal">Cancel</button>
    <button id="verify2FA" class="btn btn-primary">Verify</button>
  </div>
</div>

<!-- Deposit Modal -->
<div id="depositModal" class="modal">
  <h3>Deposit</h3>
  <input id="depositAmount" placeholder="Amount (USD)" />
  <div class="actions">
    <button class="btn" data-close="depositModal">Close</button>
    <button id="submitDeposit" class="btn btn-primary">Deposit</button>
  </div>
</div>

<!-- Withdraw Modal -->
<div id="withdrawModal" class="modal">
  <h3>Withdraw</h3>
  <input id="withdrawAmount" placeholder="Amount (USD)" />
  <div style="height:8px"></div>
  <select id="withdrawMethod">
    <option value="bank">Bank-to-Bank</option>
    <option value="paypal">PayPal</option>
    <option value="bitcoin">Bitcoin</option>
    <option value="cashapp">CashApp</option>
  </select>
  <div class="actions">
    <button class="btn" data-close="withdrawModal">Close</button>
    <button id="submitWithdraw" class="btn btn-primary">Request Withdraw</button>
  </div>
</div>


    
<!-- end  -->
    <div id="welcomeNote" class="welcomeNote">
      <img src="images/photo 5.avif" alt="img" />
      <img src="images/stock 1.webp" alt="img" />
      <img src="images/photo 7.avif" alt="img" />
      <img src="images/photo-1749741326969-e1676b3bce43.avif" alt="img" />
    </div>
    <div id="qoutes" class="qoutes">
      <p> WE ARE TRADEX</p>
      <p>"Do not save what is left after spending, but spend what is left after saving."</p>
      <p>"An investment in knowledge pays the best interest."</p>
      <p>"Successful investing is about managing risk, not avoiding it."</p>
    </div>
    <section id="features" class="features-section">
      <h2>Our Features</h2>
      <div class="features-container">
        <div class="feature-box">
          <i class="fa fa-shield-alt"></i>
          <h3>Secure Platform</h3>
          <p>
            We use top-level security to keep your data and transactions safe at
            all times.
          </p>
        </div>
        <div class="feature-box">
          <i class="fa fa-chart-line"></i>
          <h3>Live Investment Tracking</h3>
          <p>
            View real-time updates of your investment, profit, and total interest
            on your dashboard.
          </p>
        </div>
        <div class="feature-box">
          <i class="fa fa-hand-holding-usd"></i>
          <h3>Flexible Investment Plans</h3>
          <p>
            Choose from a variety of plans that suit your goals and budget with
            high returns.
          </p>
        </div>
        <div class="feature-box">
          <i class="fa fa-headset"></i>
          <h3>24/7 Support</h3>
          <p>
            Our dedicated support team is always here to help you through live
            chat or email.
          </p>
        </div>
      </div>
    </section>
    <div class="live-counter">
      <h3>Total Interest Growing:</h3>
      <p>$<span id="interestCounter">0.00</span></p>
    </div>
    <div class="countdown-box">
      <h3>Next Payout In:</h3>
      <p id="payoutCountdown">Loading...</p>
    </div>
    <section id="whyChooseUs" class="why-section">
      <h2>Why Choose TradeXInvest</h2>
      <div class="why-container">
        <div class="why-box">
          <i class="fa fa-users"></i>
          <h3>Trusted by Thousands</h3>
          <p>
            Over 10,000 investors trust us with their money, and our reviews speak
            for themselves.
          </p>
        </div>
        <div class="why-box">
          <i class="fa fa-bolt"></i>
          <h3>Fast & Easy</h3>
          <p>
            Sign up and start investing in just minutes. User-friendly and
            accessible from any device.
          </p>
        </div>
        <div class="why-box">
          <i class="fa fa-award"></i>
          <h3>Proven Results</h3>
          <p>
            We’ve consistently delivered strong returns for our investors with
            transparent performance.
          </p>
        </div>
      </div>
    </section>
    <section class="hero-section">
      <div class="hero-content">
        <h1>Invest Smart with TradeXInvest</h1>
        <p>
          Your trusted platform to grow wealth with secure and high-yield
          investment plans.
        </p>
        <div class="hero-buttons">
           <button id="ctaSignup" class="btn btn-primary">Create account</button>
          <a href="#features" class="btn-secondary">Learn More</a>
        </div>
      </div>
      <div class="hero-image">
        <img src="images/photo 5.webp" alt="Investment Image" />
      </div>
    </section>

    <section id="testimonials" class="testimonials-section">
      <h2>What Our Investors Say......</h2>
      <div class="testimonials-container">
        <div class="testimonial-box">
          <div class="stars" aria-label="Rating: 5 out of 5 stars">
            <span>⭐️⭐️⭐️⭐️⭐️</span>
          </div>
          <p>
            "TradeXInvest helped me grow my savings steadily. The dashboard is
            simple, and the support team is amazing!"
          </p>
          <h4>— Sarah U., Australia</h4>
        </div>
        <div class="testimonial-box">
          <div class="stars" aria-label="Rating: 4.5 out of 5 stars">
            <span>⭐️⭐️⭐️⭐️⭐️</span>
          </div>
          <p>
            "I was skeptical at first, but now I’m earning consistent interest on
            my investment. I recommend it 100%!"
          </p>
          <h4>— James Eudardo., Brazil</h4>
        </div>
        <div class="testimonial-box">
          <div class="stars" aria-label="Rating: 4 out of 5 stars">
            <span>⭐️⭐️⭐️⭐️⭐️</span>
          </div>
          <p>
            "What I love is the transparency. I see my profits in real time and
            the withdrawals are smooth."
          </p>
          <h4>— Anita O., New Jersey</h4>
        </div>
      </div>
    </section>

    <section class="cta-section">
      <h2>Ready to Grow Your Wealth?</h2>
      <p>Join thousands of investors earning passive income with TradeXInvest.</p>
      <p> <button id="ctaSignup" class="btn btn-primary">Get Started Now</button></p>
    </section>

    <!-- Chat widget -->
    <div id="chatWidget" class="chat-widget">
      <div
        class="chat-header"
        onclick="document.getElementById('chatWidget').style.display='none';"
      >
        💬 Chat With Us (Click header to close)
      </div>
      <div class="chat-body" id="chatBody">
        <div class="message admin">
          Hi TradeX 👋, want help choosing the best plan?
        </div>
      </div>
      <form id="chatForm">
        <input
          type="text" 
          id="chatInput"
          placeholder="Type your message..."
          autocomplete="off"
        />
        <button type="submit">Send</button>
      </form>
    </div>

    <footer class="site-footer">
      <div class="footer-content">
        <h2>TradeXInvest</h2>
        <p>Secure and smart investment platform to grow your wealth.</p>

        <!-- 🔗 Contact Info -->
        <div class="contact-info">
          <p>
            <i class="fas fa-envelope"></i>
            <a href="support@tradexinvest.net">support@tradexinvest.net</a>
          </p>
          <p>
            <i class="fas fa-phone"></i>
            <a href="https://wa.me/+13137768220">+13137768220</a>
          </p>
          <p>
            <i class="fas fa-paper-plane"></i>
            <a href="contact.html">Send Us a Message</a>
          </p>
        </div>

        <!-- 🔗 Social Media -->
        <div class="social-icons">
          <a
            href="https://signal.me/#eu/B0bK1TWO1rDFGcCqWeraUIdHqG29QV04qxhVbyN4zxW5N3TXSEtPwY6Dcy9JaDGm"
            target="_blank"
            class="icon facebook"
            ><i class="fab fa-facebook-f"></i
          ></a>
          <a
            href="https://wa.me/13137768220"
            target="_blank"
            class="icon whatsapp"
            ><i class="fab fa-whatsapp"></i
          ></a>
          <a href="https://twitter.com" target="_blank" class="icon twitter"
            ><i class="fab fa-x-twitter"></i
          ></a>
          <a
            href="https://instagram.com"
            target="_blank"
            class="icon instagram"
            ><i class="fab fa-instagram"></i
          ></a>
        </div>
        <div><a href="security.html">Security & Protection</a></div>

        <p class="copyright">&copy; 2025 TradeXInvest. All rights reserved.</p>
      </div>
      

    </footer>
<script>
// Function to toggle mobile nav
function toggleMobileNav() {
  const mobileMenu = document.getElementById("mobileMenu");
  if (!mobileMenu) return; // prevent error if element not found
  mobileMenu.classList.toggle("show"); // toggles the 'show' class
}

let interest = 8000; // Starting interest
const interestRatePerSecond = 0.05; // Amount to grow every second (you can adjust)
const interestEl = document.getElementById("interestCounter");

function updateInterest() {
  interest += interestRatePerSecond;
  interestEl.textContent = interest.toFixed(2);
}
setInterval(updateInterest, 1000); // Update every 1 second


// ====== NEXT PAYOUT COUNTDOWN ======
const countdownEl = document.getElementById("payoutCountdown");

// Example: set next payout 48 hours from now
const nextPayoutDate = new Date();
nextPayoutDate.setHours(nextPayoutDate.getHours() + 48);

function updateCountdown() {
  const now = new Date().getTime();
  const distance = nextPayoutDate - now;

  if (distance < 0) {
    countdownEl.textContent = "Payout processing...";
    return;
  }

  const days = Math.floor(distance / (1000 * 60 * 60 * 24));
  const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  const seconds = Math.floor((distance % (1000 * 60)) / 1000);

  let output = "";
  if (days > 0) output += `${days}d `;
  output += `${hours}h ${minutes}m ${seconds}s`;

  countdownEl.textContent = output;
}
setInterval(updateCountdown, 1000); // Update every









// Expose globally if using inline onclick
window.toggleMobileNav = toggleMobileNav;


let countdownTimer = null;

/* ===========================
   HELPERS: MODALS & STATE
=========================== */
const overlay = document.getElementById("overlay");
function openModal(id){
  overlay.style.display = "block";
  document.getElementById(id).style.display = "block";
}
function closeModal(id){
  const el = document.getElementById(id);
  if(el) el.style.display = "none";
  // If no other modal is open, hide overlay
  const anyOpen = [...document.querySelectorAll(".modal")].some(m => m.style.display === "block");
  if(!anyOpen) overlay.style.display = "none";
}
overlay.addEventListener("click", ()=>{
  document.querySelectorAll(".modal").forEach(m=>m.style.display="none");
  overlay.style.display="none";
});
document.querySelectorAll("[data-close]").forEach(btn=>{
  btn.addEventListener("click", ()=> closeModal(btn.getAttribute("data-close")));
});

function currency(n){ return Number(n||0).toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2}); }
function setSession(user, jwt){
  if(user) localStorage.setItem("currentUser", JSON.stringify(user));
  if(jwt)  localStorage.setItem("jwtToken", jwt);
}
function clearSession(){
  localStorage.clear();
}

/* ===========================
   SLIDERS
=========================== */
(function sliders(){
  const imgs = document.querySelectorAll("#welcomeNote img");
  const quotes = document.querySelectorAll("#quotes p");
  let i=0, q=0;
  function showImg(k){ imgs.forEach((im,idx)=>im.classList.toggle("active", idx===k)); }
  function showQuote(k){ quotes.forEach((p,idx)=>p.classList.toggle("active", idx===k)); }
  showImg(0); showQuote(0);
  setInterval(()=>{ i=(i+1)%imgs.length; showImg(i); }, 3000);
  setInterval(()=>{ q=(q+1)%quotes.length; showQuote(q); }, 3000);
})();

/* ===========================
   SIGNUP
=========================== */
document.getElementById("openSignup").onclick = ()=> openModal("signupModal");
document.getElementById("ctaSignup").onclick  = ()=> openModal("signupModal");


const backendUrl = "https://tradexinvestments.onrender.com"; // Change to your backend

document.getElementById("signupSubmit").addEventListener("click", async () => {
  const name = document.getElementById("suName").value.trim();
  const email = document.getElementById("suEmail").value.trim();
  const password = document.getElementById("suPassword").value.trim();

  if (!name || !email || !password) {
    alert("Please fill in all fields.");
    return;
  }

  try {
    const res = await fetch(`${backendUrl}/api/auth/register`, { 
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, email, password })
    });

    const data = await res.json();

    if (res.ok) {
      alert("Account created successfully! You can now log in.");
      document.querySelector('[data-close="signupModal"]').click();
    } else {
      alert(data.message || "Signup failed.");
    }
  } catch (err) {
    console.error("Signup error:", err);
    alert("Something went wrong. Please try again.");
  }
});


// ----- LOGIN / TERMS / 2FA -----




(() => {
  const backendUrl = "https://tradexinvestments.onrender.com";

  // ---------- helpers ----------
  const token = () => localStorage.getItem("jwtToken") || "";
  const authHeaders = () => ({
    "Content-Type": "application/json",
    "Authorization": `Bearer ${token()}`
  });
  const $ = (sel) => document.querySelector(sel);
  const fmtMoney = (n) => Number(n || 0).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
  const fmtDate = (d) => new Date(d).toLocaleString();

  // ---------- user stats ----------
  function hydrateStatsFromUser(user) {
    if (!user) return;
    $("#statBalance") && ($("#statBalance").textContent = fmtMoney(user.balance ?? 0));
    $("#statProfit") && ($("#statProfit").textContent = fmtMoney(user.profit ?? 0));
    $("#statInterest") && ($("#statInterest").textContent = fmtMoney(user.interest ?? 0));
    $("#welcomeUser") && ($("#welcomeUser").textContent = `Welcome, ${user.name || "User"}`);
    $("#welcomeEmail") && ($("#welcomeEmail").textContent = user.email || "");
  }

  // ---------- transactions ----------
  async function loadTransactions() {
    const tbody = $("#txTable tbody");
    if (!tbody) return;
    tbody.innerHTML = `<tr><td colspan="4">Loading...</td></tr>`;
    try {
      const res = await fetch(`${backendUrl}/api/transactions/my`, { headers: authHeaders() });
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || "Failed to load transactions");

      const txs = Array.isArray(data.transactions) ? data.transactions : data;
      tbody.innerHTML = txs.length
        ? txs.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
             .map(tx => `<tr>
               <td>${fmtDate(tx.createdAt)}</td>
               <td>${(tx.type || "").toUpperCase()}</td>
               <td>$${fmtMoney(tx.amount)}</td>
               <td>${(tx.status || "pending").toUpperCase()}</td>
             </tr>`).join("")
        : `<tr><td colspan="4">No transactions yet.</td></tr>`;
    } catch (e) {
      tbody.innerHTML = `<tr><td colspan="4">Error: ${e.message}</td></tr>`;
    }
  }

  // ---------- dashboard ----------
  function showDashboard(user) {
    if (!user) return console.warn("No user provided");

    window.closeModal?.("loginModal");
    window.closeModal?.("termsModal");
    window.closeModal?.("twoFAModal");

    const dashboardCard = $("#dashboardCard");
    dashboardCard?.classList.remove("hidden");
    hydrateStatsFromUser(user);

    $("#depositBtn")?.addEventListener("click", () => window.openModal?.("depositModal"));
    $("#withdrawBtn")?.addEventListener("click", () => window.openModal?.("withdrawModal"));

    loadTransactions();

    // ---------- topbar buttons ----------
    $("#openLogin")?.classList.add("hidden");
    $("#openSignup")?.classList.add("hidden");
    $("#openDashboard")?.classList.remove("hidden");
    $("#logoutTop")?.classList.remove("hidden");

    // ---------- logout ----------
    const logoutBtn = $("#logoutTop");
    if (logoutBtn && !logoutBtn.dataset.listenerAdded) {
      logoutBtn.addEventListener("click", () => {
        localStorage.removeItem("jwtToken");
        localStorage.removeItem("currentUser");
        dashboardCard?.classList.add("hidden");
        $("#openLogin")?.classList.remove("hidden");
        $("#openSignup")?.classList.remove("hidden");
        $("#openDashboard")?.classList.add("hidden");
        logoutBtn.classList.add("hidden");
      });
      logoutBtn.dataset.listenerAdded = "true";
    }
  }

  // ---------- login & 2FA ----------
  document.addEventListener("DOMContentLoaded", () => {
    const loginBtn = $("#loginSubmit");
    const emailInput = $("#liEmail");
    const passInput = $("#liPassword");
    const termsBtn = $("#acceptTerms");
    const verify2Btn = $("#verify2FA");
    const resend2Btn = $("#resend2FA");

    const savedUser = localStorage.getItem("currentUser");
if (savedUser) {
  try {
    const userObj = JSON.parse(savedUser);
    showDashboard(userObj);
  } catch (err) {
    console.error("Invalid JSON in localStorage:", err);
    localStorage.removeItem("currentUser"); // optional: clean it
  }
}


    loginBtn?.addEventListener("click", async (e) => {
      e.preventDefault();
      const email = emailInput.value.trim().toLowerCase();
      const password = passInput.value.trim();
      if (!email || !password) return alert("Enter email & password");

      try {
        const res = await fetch(`${backendUrl}/api/auth/user-login`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password }),
        
        });
        const data = await res.json();
        if (!res.ok || data.success === false) throw new Error(data.message || "Invalid login");

        localStorage.setItem("currentUser", JSON.stringify({ ...data.user, tempToken: data.tempToken }));
        if (data.requiresTerms) openModal?.("termsModal");
        else if (data.requires2FA) openModal?.("twoFAModal") && startTwofaCountdown?.(300);
      } catch (err) { alert(err.message || "Login failed"); }
    });

    termsBtn?.addEventListener("click", () => {
      localStorage.setItem("termsAccepted", "true");
      closeModal?.("termsModal");
      openModal?.("twoFAModal");
      startTwofaCountdown?.(300);
    });

    verify2Btn?.addEventListener("click", async () => {
      const code = $("#twofaCode")?.value.trim();
      if (!code) return alert("Enter 2FA code");

      try {
        const user = JSON.parse(localStorage.getItem("currentUser") || "{}");
        if (!user.tempToken) return alert("2FA session missing. Login again.");
        const res = await fetch(`${backendUrl}/api/auth/verify-2fa`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ code, tempToken: user.tempToken })
        });
        const data = await res.json();
        if (!res.ok || data.success === false) throw new Error(data.message || "Invalid 2FA code");

        if (data.token) localStorage.setItem("jwtToken", data.token);
        localStorage.setItem("twoFAVerified", "true");
        localStorage.setItem("currentUser", JSON.stringify(data.user));
        showDashboard(data.user);
      } catch (err) { alert(err.message || "2FA verification failed"); }
    });

    resend2Btn?.addEventListener("click", async () => {
      try {
        const user = JSON.parse(localStorage.getItem("currentUser") || "{}");
        if (!user.email) return alert("No user found to resend 2FA code.");
        const res = await fetch(`${backendUrl}/api/auth/resend-2fa`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email: user.email })
        });
        const data = await res.json();
        if (!res.ok || data.success === false) throw new Error(data.message || "Failed to resend code");
        startTwofaCountdown?.(300);
        alert("A new 2FA code has been sent to your email.");
      } catch (err) { alert(err.message || "Could not resend code"); }
    });

    $("#openLogin")?.addEventListener("click", () => openModal("loginModal"));
    $("#ctaLogin")?.addEventListener("click", () => openModal("loginModal"));
  });

  // ---------- 2FA timer ----------
  let twofaTimer;
  function startTwofaCountdown(seconds) {
    clearInterval(twofaTimer);
    const display = $("#twofaTimer");
    let remaining = seconds;
    const updateDisplay = () => { if(display) display.textContent = `${String(Math.floor(remaining/60)).padStart(2,"0")}:${String(remaining%60).padStart(2,"0")}`; };
    updateDisplay();
    twofaTimer = setInterval(() => { remaining--; updateDisplay(); if(remaining <= 0) clearInterval(twofaTimer); }, 1000);
  }
})();

// admin login
(() => {
  const backendUrl = "https://tradexinvestments.onrender.com";
  const $ = (sel) => document.querySelector(sel);

  // 🔹 Open Admin Login Modal
  $("#openAdminLogin")?.addEventListener("click", () => openModal("adminLoginModal"));

  // 🔹 Admin Login
  $("#adminLoginSubmit")?.addEventListener("click", async () => {
    localStorage.removeItem("adminToken");
    localStorage.removeItem("currentAdmin");

    const email = $("#adminEmail").value.trim().toLowerCase();
    const password = $("#adminPassword").value.trim();
    if (!email || !password) return alert("Enter admin email & password");

    try {
      const res = await fetch(`${backendUrl}/api/auth/admin-login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
      });
      const data = await res.json();
      if (!res.ok || !data.success) throw new Error(data.message || "Invalid login");

      // ✅ Save token & admin info
      localStorage.setItem("adminToken", data.token);
      localStorage.setItem("currentAdmin", JSON.stringify(data.admin));

      closeModal("adminLoginModal");
      showAdminDashboard();
    } catch (err) { 
      alert("Login failed: " + err.message); 
    }
  });

  // 🔹 Auth headers helper
  const authHeaders = () => ({
  "Content-Type": "application/json",
  "Authorization": `Bearer ${localStorage.getItem("adminToken") || ""}`
});


  // 🔹 Show Admin Dashboard
  function showAdminDashboard() {
    $("#adminDashboard").classList.remove("hidden");
    loadAdminUsers();
    loadWithdrawals();
  }

  // 🔹 Load Users into Admin Panel
  async function loadAdminUsers() {
    const tbody = $("#adminUsersBody");
    tbody.innerHTML = `<tr><td colspan="6">Loading...</td></tr>`;
    try {
      const token = localStorage.getItem("adminToken");
const res = await fetch(`${backendUrl}/api/admin/users`, {
  method: "GET",
  headers: {
    "Content-Type": "application/json",
    Authorization: `Bearer ${token}`,  // 🔥 include token
  },
});
      const data = await res.json();
      if (!data.success) throw new Error(data.message || "Failed to load users");

      tbody.innerHTML = data.users.map(u => `
        <tr>
          <td>${u.name}</td>
          <td>${u.email}</td>
          <td><input type="number" data-id="${u._id}" data-field="balance" value="${u.amount || 0}"></td>
          <td><input type="number" data-id="${u._id}" data-field="profit" value="${u.profit || 0}"></td>
          <td><input type="number" data-id="${u._id}" data-field="interest" value="${u.interest || 0}"></td>
          <td><button class="adminSave" data-id="${u._id}">Save</button></td>
        </tr>
      `).join("");
    } catch (err) {
      tbody.innerHTML = `<tr><td colspan="6">Error: ${err.message}</td></tr>`;
    }
  }

  // 🔹 Save Updated User Stats
 document.addEventListener("click", async (e) => {
  if (e.target.classList.contains("adminSave")) {
    const id = e.target.dataset.id; // this should be the user's ID
    const row = e.target.closest("tr");
    const balance = parseFloat(row.querySelector('input[data-field="balance"]').value);
    const profit = parseFloat(row.querySelector('input[data-field="profit"]').value);
    const interest = parseFloat(row.querySelector('input[data-field="interest"]').value);

    try {
      // ✅ Save Updated User Stats
      const res = await fetch(`${backendUrl}/api/admin/users/${id}/investment`, {
  method: "PUT",
  headers: {
    ...authHeaders(),
    "Content-Type": "application/json"
  },
  body: JSON.stringify({ balance, profit, interest }) // ✅ matches backend
});

const data = await res.json();
if (!res.ok) throw new Error(data.error || "Update failed");

alert("User updated successfully!");
loadAdminUsers();

    } catch (err) {
      alert("Error updating user: " + err.message);
    }
  }
});

  // 🔹 Load Withdrawals into Admin Panel
  async function loadWithdrawals() {
    const tbody = $("#adminWdBody");
    if (!tbody) return;
    tbody.innerHTML = `<tr><td colspan="5">Loading...</td></tr>`;
    try {
      const res = await fetch(`${backendUrl}/api/admin/withdrawals`, { headers: authHeaders() });
      const data = await res.json();
      if (!data.success) throw new Error(data.message || "Failed to load withdrawals");

      tbody.innerHTML = data.withdrawals.map(w => `
        <tr>
          <td>${w.user?.email || "Unknown"}</td>
          <td>${w.method}</td>
          <td>$${w.amount}</td>
          <td>${w.status}</td>
          <td>
            <button class="approveWd" data-id="${w._id}">Approve</button>
            <button class="rejectWd" data-id="${w._id}">Reject</button>
          </td>
        </tr>
      `).join("");
    } catch (err) {
      tbody.innerHTML = `<tr><td colspan="5">Error: ${err.message}</td></tr>`;
    }
  }
  

  // 🔹 Approve/Reject Withdrawal
  document.addEventListener("click", async (e) => {
    if (e.target.classList.contains("approveWd") || e.target.classList.contains("rejectWd")) {
      const id = e.target.dataset.id;
      const action = e.target.classList.contains("approveWd") ? "approve" : "reject";

      try {
        const actionRoute = action === "approve" 
  ? `${backendUrl}/api/admin/withdrawals/${id}/confirm`
  : `${backendUrl}/api/admin/withdrawals/${id}/reject`;

const res = await fetch(actionRoute, {
  method: "PUT",
  headers: authHeaders()
});
        const data = await res.json();
        if (!res.ok || !data.success) throw new Error(data.message || "Action failed");
        alert(`Withdrawal ${action}d!`);
        loadWithdrawals();
      } catch (err) {
        alert("Error: " + err.message);
      }
    }
  });

  // 🔹 Logout
  $("#logoutAdmin")?.addEventListener("click", () => {
    localStorage.removeItem("adminToken");
    localStorage.removeItem("currentAdmin");
    $("#adminDashboard").classList.add("hidden");
  });

})();
</script>

  
</body>
</html>