<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TradeXinvest</title>
  <link rel="stylesheet" href="style.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  />
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <style>
    .testimonials-section {
      max-width: 900px;
      margin: 2rem auto;
      padding: 0 1rem;
      font-family: Arial, sans-serif;
    }
    .testimonials-container {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      justify-content: center;
    }
    .testimonial-box {
      background: #f9f9f9;
      border-radius: 8px;
      padding: 1.5rem;
      flex: 1 1 280px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      position: relative;
    }
    .testimonial-box p {
      font-size: 1.1rem;
      color: #555;
      margin: 1rem 0 0.8rem;
    }
    .testimonial-box h4 {
      color: #555;
      font-weight: 600;
      margin: 0;
    }
    .stars {
      font-size: 1.3rem;
      color: #f5a623; /* gold star color */
      user-select: none;
    }
    .stars span {
      letter-spacing: 2px;
    }
    .profile-info {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }
    .profile-info img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #ddd;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }
    .profile-info h3 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 600;
    }
    /* Hide withdraw form by default */
    .withdraw-form.hidden {
      display: none;
    }
    /* Chat widget styles */
    .chat-widget {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 300px;
      max-height: 400px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      font-family: Arial, sans-serif;
      display: none; /* hidden by default */
      z-index: 10000;
    }
    .chat-header {
      background: #007bff;
      color: white;
      padding: 10px;
      font-weight: bold;
      border-radius: 8px 8px 0 0;
      cursor: pointer;
    }
    .chat-body {
      flex-grow: 1;
      padding: 10px;
      overflow-y: auto;
      background: #f9f9f9;
    }
    .message {
      margin-bottom: 8px;
      padding: 6px 10px;
      border-radius: 12px;
      max-width: 80%;
      word-wrap: break-word;
    }
    .message.user {
      background: #d1e7dd;
      align-self: flex-end;
    }
    .message.admin {
      background: #f8d7da;
      align-self: flex-start;
    }
    .message.system {
      background: #e2e3e5;
      font-style: italic;
      color: #555;
      align-self: center;
      max-width: 90%;
    }
    #chatForm {
      display: flex;
      border-top: 1px solid #ddd;
    }
    #chatInput {
      flex-grow: 1;
      border: none;
      padding: 10px;
      font-size: 1rem;
      border-radius: 0 0 0 8px;
      outline: none;
    }
    #chatForm button {
      border: none;
      background: #007bff;
      color: white;
      padding: 0 20px;
      cursor: pointer;
      border-radius: 0 0 8px 0;
    }
    :root{
    --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#9ca3af; --brand:#22c55e; --danger:#ef4444;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .container{max-width:1100px;margin:0 auto;padding:24px}
  .grid{display:grid;gap:16px}
  .two{grid-template-columns:1fr 1fr}
  .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.2)}
  h1,h2,h3{margin:.4em 0}
  input,select,button,textarea{
    width:100%;padding:12px 14px;border-radius:12px;border:1px solid #253041;background:#0b1220;color:var(--text);
    outline:none
  }
  input::placeholder{color:#6b7280}
  button{cursor:pointer;transition:transform .05s ease, opacity .15s ease}
  button:hover{opacity:.95}
  .btn{background:#1f2937}
  .btn-primary{background:var(--brand);color:#052e16;border:none}
  .btn-danger{background:var(--danger);border:none}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .row>.grow{flex:1}
  .muted{color:var(--muted);font-size:.9rem}
  .hidden{display:none !important}

  /* Overlay + Modal */
  #overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);backdrop-filter: blur(2px);z-index:1000}
  .modal{display:none;position:fixed;inset:auto;top:50%;left:50%;transform:translate(-50%,-50%);
    background:#0b1220;border:1px solid #26334d;border-radius:16px;padding:20px;z-index:1001;min-width:min(92vw,520px)}
  .modal h3{margin-top:0}
  .modal .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px}
input[data-field="balance"] {
  pointer-events: auto;
  background-color: #fff;
}

  /* Tables */
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid #1f2937;text-align:left}
  th{color:#9ca3af;font-weight:600}

  /* Header */
  .topbar{position:sticky;top:0;background:rgba(15,23,42,.7);backdrop-filter:blur(6px);border-bottom:1px solid #1f2937;z-index:50}
  .topbar-inner{display:flex;align-items:center;justify-content:space-between;padding:12px 24px}
  .brand{font-weight:700;letter-spacing:.3px}
  .pill{padding:6px 10px;border-radius:999px;background:#0b1220;border:1px solid #1f2937}

  /* Stat cards */
  .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  .stat{background:#0b1220;border:1px solid #1f2937;border-radius:14px;padding:16px}
  .stat .label{color:#94a3b8;font-size:.9rem}
  .stat .value{font-size:1.4rem;font-weight:700;margin-top:6px}

  /* Sliders */
  #welcomeNote img{display:none;width:100%;max-height:180px;object-fit:cover;border-radius:12px;border:1px solid #1f2937}
  #welcomeNote img.active{display:block}
  #quotes p{display:none;font-style:italic;margin:0}
  #quotes p.active{display:block}

  /* Admin tabs */
  .tabs{display:flex;gap:8px;margin-bottom:10px}
  .tabs button{padding:8px 12px;border-radius:10px}
  .tabs button.active{background:#19324f}

  /* Tiny helper */
  .right{float:right}
  #dashboardCard {
  display: none;
  background-color: #0b1220;
  color: whitesmoke;
}
#dashboardCard .active {
  display: block;
}

#termsModal, #twoFAModal {
  display: none;
}
/* CSS */
#adminLoginModal {
  display: none;
}
#adminLoginModal.active {
  display: block;
} 

.transaction-item { 
  padding: 10px; 
  margin-bottom: 10px; 
  border-radius: 6px; 
  background: #f8f8f8; 
}

.status-success { color: green; font-weight: bold; }
.status-pending { color: orange; font-weight: bold; }
.status-failed { color: red; font-weight: bold; }
.tab-content {
  display: none;
}
.tab-content.active {
  display: block;
}

  </style>
</head>
<body>
  <div class="lowerNAV" onclick="toggleMobileNav()">
    <div style="display: flex; flex-direction: column; gap: 4px;">
      <span style="width: 30px; height: 4px; background-color: black;"></span>
      <span style="width: 30px; height: 4px; background-color: black;"></span>
      <span style="width: 30px; height: 4px; background-color: black;"></span>
    </div>
  </div>

  <ul class="mobile-menu" id="mobileMenu">
    <li><a href="index.html">Home</a></li>
    <li><a href="about.html">About Us</a></li>
    <li><a href="contact.html">Contact</a></li>
  </ul> 
   <div class="nav">
    <p class="logo">TradeXInvest</p>
    

    </div>
    

<!-- end of dashboard -->
 <!-- Topbar -->
<div class="topbar">
  <div class="topbar-inner container">
    <div class="brand">TradexInvest</div>
    <div class="row">
      <button id="openLogin" class="pill">Login</button>
      <button id="openSignup" class="pill">Sign Up</button>
      <button id="openDashboard" class="pill hidden">Dashboard</button>
      <button id="openAdminLogin" class="pill ">Admin</button>
      <button id="logoutTop" class="pill hidden">Logout</button>
      
    </div>
  </div>
</div>
  <div class="card">
      <h3>Welcome</h3>
      <div id="welcomeNote">
        <img src="https://picsum.photos/seed/a/1100/280" class="active" alt="">
        <img src="https://picsum.photos/seed/b/1100/280" alt="">
        <img src="https://picsum.photos/seed/c/1100/280" alt="">
      </div>
      <div style="margin-top:12px" id="quotes">
        <p class="active">“Invest smart, live better.”</p>
        <p>“Your future starts today.”</p>
        <p>“Profit is a journey, not a destination.”</p>
      </div>
    </div>

<div class="container grid two">

  <!-- Public / left column -->
  <div class="grid">
    <div class="card">
      <h2>Get started</h2>
      <p class="muted">Create an account, log in, accept the terms, verify 2FA, then manage your investments — all on this page.</p>
      <div class="row">
        <button id="ctaSignup" class="btn btn-primary">Create account</button>
        <button id="ctaLogin" class="btn">I already have an account</button>
      </div>
    </div>
</div>
    

  <!-- Dashboard / right column -->
  <div class="grid">
<div id="adminDashboard" class="card hidden">
  <h2>Admin Dashboard</h2>
  <button id="logoutAdmin" class="btn">Logout</button>

  <!-- Tabs -->
  <div class="tabs">
  <button data-tab="usersTab" class="btn active">Users</button>
  <button data-tab="withdrawalsTab" class="btn">Withdrawals</button>
</div>
  


  <!-- Users Tab -->
  <div id="usersTab">
    <h3>Manage Users</h3>
    <table>
      <thead>
        <tr>
          <th>Name</th><th>Email</th><th>Balance</th><th>Profit</th><th>Interest</th><th>Actions</th>
        </tr>
      </thead>
      <tbody id="adminUsersBody"></tbody>
    </table>
  </div>



<div id="withdrawalsTab" class="tab-content" style="display:none;">
  <h2>Withdrawals</h2>
  <table id="withdrawalsTable">
    <thead>
      <tr>
        <th>User</th>
        <th>Method</th>
        <th>Amount</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <!-- Filled by JS loadWithdrawals() -->
    </tbody>
  </table>
</div>
  <div id="adminTransactions" class="card">
  <h3>All Transactions</h3>
  <table>
    <thead>
      <tr>
        <th>User</th>
        <th>Type</th>
        <th>Amount</th>
        <th>Method</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody id="transactionsTableBody"></tbody>
  </table>
</div>
<form id="addInvestmentForm">
  <input id="investmentUserId"  /> <!-- Admin will select a user and store their ID here -->
  <input id="investmentAmount" type="number" placeholder="Amount" required />
  <select id="investmentMethod">
    <option value="Bank Transfer">Bank Transfer</option>
    <option value="PayPal">PayPal</option>
    <option value="Bitcoin">Bitcoin</option>
    <option value="CashApp">CashApp</option>
  </select>
  <input id="investmentDate" type="date" required />
  <button type="submit">Add Investment</button>
</form>


<table id="investmentsTable">
  <thead>
    <tr>
      <th>Amount</th>
      <th>Method</th>
      <th>Date</th>
      </tr>
  </thead>
  <tbody id="investmentsBody">
    <!-- Investments will be loaded here -->
  </tbody>
</table>
   





<!-- ================= Edit User Modal ================= -->
<div id="updateUserForm" class="modal hidden">
  <div class="modal-content">
    <h3>Edit User</h3>
    <label>Name <input type="text" id="editName" /></label>
    <label>Email <input type="email" id="editEmail" /></label>
    <label>Balance <input type="number" id="editBalance" /></label>
    <label>Profit <input type="number" id="editProfit" /></label>
    <label>Interest <input type="number" id="editInterest" /></label>
    <button id="saveUserBtn" class="btn">Save</button>
    <button onclick="closeModal('editUserModal')" class="btn">Cancel</button>
  </div>
</div>
  </div>
  </div>
  </div>



<div class="grid">
  <div class="card">
  <div id="dashboardCard" class="card hidden ">
     <h2 id="userWelcome">Welcome User</h2>
<button id="openDepositBtn" class=" btn btn-primary"> Deposit</button>
<button id="openWithdrawBtn" class="btn btn-primary">Withdraw</button> 

<div class="stats">
  
    <p>Balance: <span id="statBalance">0.00</span> USD</p>
    <p>Profit: <span id="statProfit">0.00</span> USD</p>
    <p>Interest: <span id="statInterest">0.00</span> USD</p>
      <p>Invested Amount: <span id="statInvestment">$0</span>USD</p> 
  </div>

  <div class="transactions">
    <h3>Transaction History</h3>
    <div id="transactionsList"></div>
  </div>
  <!-- Investment History Section -->
<table id="transactionHistory"  class="transactions" >
  <thead>
    <tr>
      <th>Date</th>
      <th>Type</th>
      <th>Amount</th>
      <th>Method</th>
    </tr>
  </thead>
  <tbody id="transactionsList"></tbody>
</table>
</div>
 </div>
 </div>
<!-- Deposit Modal -->
<div id="depositModal" class="modal">
  <h3>Deposit</h3>
  <input id="depositAmount" placeholder="Amount (USD)" />
  <div class="actions">
    <button class="btn" data-close="depositModal">Close</button>
    <button id="DepositBtn" class="btn btn-primary">Deposit</button>
  </div>
</div>


<!-- Withdraw Modal -->
<div id="withdrawModal" class="modal">
  <h3>Withdraw</h3>
  <input id="withdrawAmount" placeholder="Amount (USD)" />
  <div style="height:8px"></div>
  <select id="withdrawMethod">
    <option value="bank">Bank-to-Bank</option>
    <option value="paypal">PayPal</option>
    <option value="bitcoin">Bitcoin</option>
    <option value="cashapp">CashApp</option>
  </select>
  <div class="actions">
    <button class="btn" data-close="withdrawModal">Close</button>
    <button id="WithdrawBtn" class="btn btn-primary">Request Withdraw</button>
  </div>
</div>


   


<!-- ===== Overlay + Modals ===== -->
<div id="overlay"></div>

<!-- Signup Modal -->
<div id="signupModal" class="modal">
  <h3>Create account</h3>
  <div class="row">
    <input id="suName" placeholder="Full name" class="grow" />
    <input id="suEmail" placeholder="Email" class="grow" />
  </div>
  <div class="row" style="margin-top:10px">
    <input id="suPassword" placeholder="Password" type="password" class="grow" />
  </div>
  <div class="actions">
    <button class="btn" data-close="signupModal">Cancel</button>
    <button id="signupSubmit" class="btn btn-primary">Sign Up</button>
  </div>
</div>
<!-- Admin Login Button (hidden for regular users) -->

<div id="adminLoginModal" class="modal ">
  <h3>Admin Login</h3>
  <input id="adminEmail" type="email" placeholder="Admin Email" />
  <input id="adminPassword" type="password" placeholder="Password" />
  <button id="adminLoginSubmit">Login</button>
  <button onclick="closeModal('adminLoginModal')">Cancel</button>
</div>

<!-- Login Modal -->
<div id="loginModal" class="modal">
  <h3>Login</h3>
  <input type="email" id="liEmail" placeholder="Email" />
  <div style="height:8px"></div>
  <input  id="liPassword" placeholder="Password" type="password" />
  <input type="hidden" id="loginType" value="admin"> 
  <div class="actions">
    <button class="btn" data-close="loginModal">Cancel</button>
    <button id="loginSubmit" class="btn btn-primary">Login</button>
  </div>
</div>

<!-- Terms Modal -->
<!-- Terms Modal -->
<div id="termsModal" class="modal">
  <h3>Terms & Conditions</h3>
  <div style="max-height:220px;overflow:auto;border:1px solid #1f2937;border-radius:10px;padding:12px">
    <p class="muted">By continuing, you agree to our terms regarding investments, risk disclosure, and platform policies.</p>
    <ul class="muted">
      <li>Investments involve risk of loss.</li>
      <li>Profits shown are indicative and not guaranteed.</li>
      <li>We may require identity verification for withdrawals.</li>
    </ul>
  </div>
  <div class="actions">
    <button class="btn" data-close="termsModal">Decline</button>
    <button id="acceptTermsBtn" class="btn btn-primary">I Accept</button>
  </div>
</div>

<!-- 2FA Modal -->
<div id="twoFAModal" class="modal">
  <h3>Two-Factor Verification</h3>
  <p class="muted" id="twofaHint">We’ve emailed a 6-digit code to your address.</p>
  <input id="twofaCode" placeholder="Enter 2FA code" />
  <div class="row" style="align-items:center;margin-top:8px">
    <div id="countdown" class="muted">Code expires in 5:00</div>
    <button id="resend2FA" class="btn right">Resend code</button>
  </div>
  <div class="actions">
    <button class="btn" data-close="twoFAModal">Cancel</button>
    <button id="verify2FABtn" class="btn btn-primary">Verify</button>
  </div>
</div>

<!-- end  -->
    <div id="welcomeNote" class="welcomeNote">
      <img src="images/photo 5.avif" alt="img" />
      <img src="images/stock 1.webp" alt="img" />
      <img src="images/photo 7.avif" alt="img" />
      <img src="images/photo-1749741326969-e1676b3bce43.avif" alt="img" />
    </div>
    <div id="qoutes" class="qoutes">
      <p> WE ARE TRADEX</p>
      <p>"Do not save what is left after spending, but spend what is left after saving."</p>
      <p>"An investment in knowledge pays the best interest."</p>
      <p>"Successful investing is about managing risk, not avoiding it."</p>
    </div>
    <section id="features" class="features-section">
      <h2>Our Features</h2>
      <div class="features-container">
        <div class="feature-box">
          <i class="fa fa-shield-alt"></i>
          <h3>Secure Platform</h3>
          <p>
            We use top-level security to keep your data and transactions safe at
            all times.
          </p>
        </div>
        <div class="feature-box">
          <i class="fa fa-chart-line"></i>
          <h3>Live Investment Tracking</h3>
          <p>
            View real-time updates of your investment, profit, and total interest
            on your dashboard.
          </p>
        </div>
        <div class="feature-box">
          <i class="fa fa-hand-holding-usd"></i>
          <h3>Flexible Investment Plans</h3>
          <p>
            Choose from a variety of plans that suit your goals and budget with
            high returns.
          </p>
        </div>
        <div class="feature-box">
          <i class="fa fa-headset"></i>
          <h3>24/7 Support</h3>
          <p>
            Our dedicated support team is always here to help you through live
            chat or email.
          </p>
        </div>
      </div>
    </section>
    <div class="live-counter">
      <h3>Total Interest Growing:</h3>
      <p>$<span id="interestCounter">0.00</span></p>
    </div>
    <div class="countdown-box">
      <h3>Next Payout In:</h3>
      <p id="payoutCountdown">Loading...</p>
    </div>
    <section id="whyChooseUs" class="why-section">
      <h2>Why Choose TradeXInvest</h2>
      <div class="why-container">
        <div class="why-box">
          <i class="fa fa-users"></i>
          <h3>Trusted by Thousands</h3>
          <p>
            Over 10,000 investors trust us with their money, and our reviews speak
            for themselves.
          </p>
        </div>
        <div class="why-box">
          <i class="fa fa-bolt"></i>
          <h3>Fast & Easy</h3>
          <p>
            Sign up and start investing in just minutes. User-friendly and
            accessible from any device.
          </p>
        </div>
        <div class="why-box">
          <i class="fa fa-award"></i>
          <h3>Proven Results</h3>
          <p>
            We’ve consistently delivered strong returns for our investors with
            transparent performance.
          </p>
        </div>
      </div>
    </section>
    <section class="hero-section">
      <div class="hero-content">
        <h1>Invest Smart with TradeXInvest</h1>
        <p>
          Your trusted platform to grow wealth with secure and high-yield
          investment plans.
        </p>
        <div class="hero-buttons">
           <button id="ctaSignup" class="btn btn-primary">Create account</button>
          <a href="#features" class="btn-secondary">Learn More</a>
        </div>
      </div>
      <div class="hero-image">
        <img src="images/photo 5.webp" alt="Investment Image" />
      </div>
    </section>

    <section id="testimonials" class="testimonials-section">
      <h2>What Our Investors Say......</h2>
      <div class="testimonials-container">
        <div class="testimonial-box">
          <div class="stars" aria-label="Rating: 5 out of 5 stars">
            <span>⭐️⭐️⭐️⭐️⭐️</span>
          </div>
          <p>
            "TradeXInvest helped me grow my savings steadily. The dashboard is
            simple, and the support team is amazing!"
          </p>
          <h4>— Sarah U., Australia</h4>
        </div>
        <div class="testimonial-box">
          <div class="stars" aria-label="Rating: 4.5 out of 5 stars">
            <span>⭐️⭐️⭐️⭐️⭐️</span>
          </div>
          <p>
            "I was skeptical at first, but now I’m earning consistent interest on
            my investment. I recommend it 100%!"
          </p>
          <h4>— James Eudardo., Brazil</h4>
        </div>
        <div class="testimonial-box">
          <div class="stars" aria-label="Rating: 4 out of 5 stars">
            <span>⭐️⭐️⭐️⭐️⭐️</span>
          </div>
          <p>
            "What I love is the transparency. I see my profits in real time and
            the withdrawals are smooth."
          </p>
          <h4>— Anita O., New Jersey</h4>
        </div>
      </div>
    </section>

    <section class="cta-section">
      <h2>Ready to Grow Your Wealth?</h2>
      <p>Join thousands of investors earning passive income with TradeXInvest.</p>
      <p> <button id="ctaSignup" class="btn btn-primary">Get Started Now</button></p>
    </section>

    <!-- Chat widget -->
    <div id="chatWidget" class="chat-widget">
      <div
        class="chat-header"
        onclick="document.getElementById('chatWidget').style.display='none';"
      >
        💬 Chat With Us (Click header to close)
      </div>
      <div class="chat-body" id="chatBody">
        <div class="message admin">
          Hi TradeX 👋, want help choosing the best plan?
        </div>
      </div>
      <form id="chatForm">
        <input
          type="text" 
          id="chatInput"
          placeholder="Type your message..."
          autocomplete="off"
        />
        <button type="submit">Send</button>
      </form>
    </div>

    <footer class="site-footer">
      <div class="footer-content">
        <h2>TradeXInvest</h2>
        <p>Secure and smart investment platform to grow your wealth.</p>

        <!-- 🔗 Contact Info -->
        <div class="contact-info">
          <p>
            <i class="fas fa-envelope"></i>
            <p>Need help? Contact our support team</p>
            <a href="support@tradexinvest.net">support@tradexinvest.net</a>
          </p>
          <p>
            <i class="fas fa-phone"></i>
            <a href="https://wa.me/+13137768220">+13137768220</a>
          </p>
          <p>
            <i class="fas fa-paper-plane"></i>
            <a href="contact.html">Send Us a Message</a>
          </p>
        </div>

        <!-- 🔗 Social Media -->
        <div class="social-icons">
          <a
            href="https://signal.me/#eu/B0bK1TWO1rDFGcCqWeraUIdHqG29QV04qxhVbyN4zxW5N3TXSEtPwY6Dcy9JaDGm"
            target="_blank"
            class="icon facebook"
            ><i class="fab fa-facebook-f"></i
          ></a>
          <a
            href="https://wa.me/13137768220"
            target="_blank"
            class="icon whatsapp"
            ><i class="fab fa-whatsapp"></i
          ></a>
          <a href="https://twitter.com" target="_blank" class="icon twitter"
            ><i class="fab fa-x-twitter"></i
          ></a>
          <a
            href="https://instagram.com"
            target="_blank"
            class="icon instagram"
            ><i class="fab fa-instagram"></i
          ></a>
        </div>
        <div><a href="security.html">Security & Protection</a></div>

        <p class="copyright">&copy; 2025 TradeXInvest. All rights reserved.</p>
      </div>
      

    </footer>   
   <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
   <script src="admin.js" type="module"></script> 
<script> 
  
// Function to toggle mobile nav
function toggleMobileNav() {
  const mobileMenu = document.getElementById("mobileMenu");
  if (!mobileMenu) return; // prevent error if element not found
  mobileMenu.classList.toggle("show"); // toggles the 'show' class
}

let interest = 8000; // Starting interest
const interestRatePerSecond = 0.05; // Amount to grow every second (you can adjust)
const interestEl = document.getElementById("interestCounter");

function updateInterest() {
  interest += interestRatePerSecond;
  interestEl.textContent = interest.toFixed(2);
}
setInterval(updateInterest, 1000); // Update every 1 second


// ====== NEXT PAYOUT COUNTDOWN ======
const countdownEl = document.getElementById("payoutCountdown");

// Example: set next payout 48 hours from now
const nextPayoutDate = new Date();
nextPayoutDate.setHours(nextPayoutDate.getHours() + 48);

function updateCountdown() {
  const now = new Date().getTime();
  const distance = nextPayoutDate - now;

  if (distance < 0) {
    countdownEl.textContent = "Payout processing...";
    return;
  }

  const days = Math.floor(distance / (1000 * 60 * 60 * 24));
  const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  const seconds = Math.floor((distance % (1000 * 60)) / 1000);

  let output = "";
  if (days > 0) output += `${days}d `;
  output += `${hours}h ${minutes}m ${seconds}s`;

  countdownEl.textContent = output;
}
setInterval(updateCountdown, 1000); // Update every









// Expose globally if using inline onclick
window.toggleMobileNav = toggleMobileNav;


let countdownTimer = null;

/* ===========================
   HELPERS: MODALS & STATE
=========================== */
const overlay = document.getElementById("overlay");
function openModal(id){
  overlay.style.display = "block";
  document.getElementById(id).style.display = "block";
}
function closeModal(id){
  const el = document.getElementById(id);
  if(el) el.style.display = "none";
  // If no other modal is open, hide overlay
  const anyOpen = [...document.querySelectorAll(".modal")].some(m => m.style.display === "block");
  if(!anyOpen) overlay.style.display = "none";
}
overlay.addEventListener("click", ()=>{
  document.querySelectorAll(".modal").forEach(m=>m.style.display="none");
  overlay.style.display="none";
});
document.querySelectorAll("[data-close]").forEach(btn=>{
  btn.addEventListener("click", ()=> closeModal(btn.getAttribute("data-close")));
});

function currency(n){ return Number(n||0).toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2}); }
function setSession(user, jwt){
  if(user) localStorage.setItem("currentUser", JSON.stringify(user));
  if(jwt)  localStorage.setItem("jwtToken", jwt);
}
function clearSession(){
  localStorage.clear();
}
const tabButtons = document.querySelectorAll('.tabs .btn');
  const tabContents = document.querySelectorAll('.tab-content');

  tabButtons.forEach(button => {
    button.addEventListener('click', () => {
      const target = button.dataset.tab;

      // Remove 'active' from all buttons
      tabButtons.forEach(btn => btn.classList.remove('active'));
      // Hide all tab contents
      tabContents.forEach(content => (content.style.display = 'none'));

      // Add 'active' to clicked button
      button.classList.add('active');
      // Show the selected tab content
      document.getElementById(target).style.display = 'block';
    });
  });

/* ===========================
   SLIDERS
=========================== */
(function sliders(){
  const imgs = document.querySelectorAll("#welcomeNote img");
  const quotes = document.querySelectorAll("#quotes p");
  let i=0, q=0;
  function showImg(k){ imgs.forEach((im,idx)=>im.classList.toggle("active", idx===k)); }
  function showQuote(k){ quotes.forEach((p,idx)=>p.classList.toggle("active", idx===k)); }
  showImg(0); showQuote(0);
  setInterval(()=>{ i=(i+1)%imgs.length; showImg(i); }, 3000);
  setInterval(()=>{ q=(q+1)%quotes.length; showQuote(q); }, 3000);
})();
document.getElementById("openLogin")?.addEventListener("click", () => openModal("loginModal"));
document.getElementById("ctaLogin")?.addEventListener("click", () => openModal("loginModal"));

// ---------- Admin Login ----------
document.getElementById("openAdminLogin")?.addEventListener("click", () => openModal("adminLoginModal"));
document.getElementById("ctaAdminLogin")?.addEventListener("click", () => openModal("adminLoginModal"));
/* ===========================
   SIGNUP
=========================== */
document.getElementById("openSignup").onclick = ()=> openModal("signupModal");
document.getElementById("ctaSignup").onclick  = ()=> openModal("signupModal");


const backendUrl = "https://www.tradexinvest.net"; // Change to your backend

document.getElementById("signupSubmit").addEventListener("click", async () => {
  const name = document.getElementById("suName").value.trim();
  const email = document.getElementById("suEmail").value.trim();
  const password = document.getElementById("suPassword").value.trim();

  if (!name || !email || !password) {
    alert("Please fill in all fields.");
    return;
  }

  try {
    const res = await fetch(`${backendUrl}/api/auth/register`, { 
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, email, password })
    });

    const data = await res.json();

    if (res.ok) {
      alert("Account created successfully! You can now log in.");
      document.querySelector('[data-close="signupModal"]').click();
    } else {
      alert(data.message || "Signup failed.");
    }
  } catch (err) {
    console.error("Signup error:", err);
    alert("Something went wrong. Please try again.");
  }
});


document.getElementById("openSignup").onclick = ()=> openModal("signupModal");
document.getElementById("ctaSignup").onclick  = ()=> openModal("signupModal");


document.addEventListener("DOMContentLoaded", () => {
  const backendUrl = "https://www.tradexinvest.net";
  const $ = (sel) => document.querySelector(sel);
function openModal(id) {
    const modal = $("#" + id);
    if (modal) modal.style.display = "block";
  }

  function closeModal(id) {
    const modal = $("#" + id);
    if (modal) modal.style.display = "none";
  }

  // ---------- Close buttons ----------
  document.querySelectorAll("[data-close]").forEach(btn => {
    btn.addEventListener("click", () => {
      closeModal(btn.dataset.close);
    });
  });
 

  // ---------- Helpers ----------
  const token = () => localStorage.getItem("jwtToken") || "";
  const authHeaders = () => ({
    "Content-Type": "application/json",
    "Authorization": `Bearer ${token()}`
  });
  
  const fmtDate = (d) => new Date(d).toLocaleString();

  // ---------- User Stats ----------
  const fmtMoney = (n) =>
  Number(n || 0).toLocaleString(undefined, {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2,
  });

// Hydrate user stats into the dashboard
// When user logs in, hydrate dashboard from DB data
function hydrateStatsFromUser(user) {
  if (!user) return;

  const investments = user.investments || [];

  // ---- Total Investment ----
  const totalInvestment = investments.reduce((sum, inv) => sum + (inv.amount || 0), 0);
  const statInvestmentEl = document.getElementById("statInvestment");
  if (statInvestmentEl) statInvestmentEl.innerText = `$${totalInvestment.toFixed(2)}`;

  // ---- Transaction List ----
  const txList = document.getElementById("transactionsList");
  if (!txList) return;
  txList.innerHTML = "";

  if (investments.length === 0) {
    txList.innerHTML = "<p>No transactions yet</p>";
    return;
  }

  // Show newest first
  investments.slice().reverse().forEach(inv => {
    const txItem = document.createElement("div");
    txItem.className = "transaction-item";
    txItem.innerHTML = `
      <span class="tx-amount">$${(inv.amount || 0).toFixed(2)}</span>
      <span class="tx-method">${inv.method || "N/A"}</span>
      <span class="tx-date">${new Date(inv.date).toLocaleDateString()}</span>
    `;
    txList.appendChild(txItem);
  });
}

async function loadTransactions() {
  const tbody = document.querySelector("#txTable tbody");
  if (!tbody) return;

  tbody.innerHTML = `<tr><td colspan="4">Loading...</td></tr>`;

  try {
    const res = await fetch(`${backendUrl}/api/transactions/my`, {
      headers: authHeaders()
    });
    const data = await res.json();

    if (!res.ok) throw new Error(data.message || "Failed to load transactions");

    // Normalize transactions array
    let txs = [];
    if (Array.isArray(data.transactions)) {
      txs = data.transactions;
    } else if (data && data._id) {
      txs = [data];
    }

    if (txs.length === 0) {
      tbody.innerHTML = `<tr><td colspan="4">No transactions yet.</td></tr>`;
      return;
    }

    // Sort by latest first and map to table rows
    tbody.innerHTML = txs
      .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
      .map(tx => `
        <tr>
          <td>${fmtDate(tx.createdAt)}</td>
          <td>${(tx.type || "").toUpperCase()}</td>
          <td>$${fmtMoney(tx.amount)}</td>
          <td>${(tx.status || "pending").toUpperCase()}</td>
        </tr>
      `).join("");

  } catch (err) {
    console.error("Failed to load transactions:", err);
    tbody.innerHTML = `<tr><td colspan="4">Error: ${err.message || "Could not load transactions"}</td></tr>`;
  }
}

  

  $("#WithdrawBtn")?.addEventListener("click", async () => {
  const amount = parseFloat($("#withdrawAmount").value);
  const method = $("#withdrawMethod").value;

  if (!amount || amount <= 0) {
    return alert("Enter a valid withdrawal amount.");
  }

  try {
    // Send request to backend (pending by default)
    const res = await fetch(`${backendUrl}/api/withdrawals`, {
      method: "POST",
      headers: { 
        "Content-Type": "application/json",
        "Authorization": `Bearer ${localStorage.getItem("jwtToken")}`
      },
      body: JSON.stringify({ amount, method })
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.message || "Error creating withdrawal");

    alert("Withdrawal request submitted. Status: Pending");
    $("#withdrawAmount").value = "";
    $("#withdrawMethod").value = "bank";
    closeModal("withdrawModal");

  } catch (err) {
    alert("Failed: " + err.message);
  }
});
$("#DepositBtn")?.addEventListener("click", () => {
    const amount = parseFloat($("#depositAmount").value);
    if (!amount || amount <= 0) {
      alert("Enter a valid deposit amount.");
      return;
    }

    // Example action (replace with API call)
    alert(`Deposit of $${amount.toFixed(2)} submitted successfully!`);
    $("#depositAmount").value = "";
    closeModal("depositModal");
  });
  

  // ---------- Show User Dashboard ----------
   function showUserDashboard(user) {
    const dashboardCard = $("#dashboardCard");
  
    
    if (!user) return;
  const inv = user.investment || {};

  // ✅ make sure these IDs exist in your HTML
  
  const balanceEl = $("#statBalance");
  const profitEl = $("#statProfit");
  const interestEl = $("#statInterest");
  const welcomeEl = $("#userWelcome");

  if (balanceEl) balanceEl.textContent = fmtMoney(inv.balance || 0);
  if (profitEl) profitEl.textContent = fmtMoney(inv.profit || 0);
  if (interestEl) interestEl.textContent = fmtMoney(inv.interest || 0);
  if (welcomeEl) welcomeEl.textContent = `Welcome ${user.name || "User"}`;

  $("#dashboardCard").style.display = "block";



    window.closeModal?.("loginModal");
    window.closeModal?.("termsModal");
    window.closeModal?.("twoFAModal");

    $("#dashboardCard")?.classList.remove("hidden");
     

   
   
  $("#openDepositBtn")?.addEventListener("click", () => window.openModal?.("depositModal"));
    $("#openWithdrawBtn")?.addEventListener("click", () => window.openModal?.("withdrawModal"));
hydrateStatsFromUser(user);
    // You can also load the investments table if you want
    loadInvestments({user_id});
   loadTransactions()

    $("#openLogin")?.classList.add("hidden");
    $("#openSignup")?.classList.add("hidden");
    $("#openDashboard")?.classList.remove("hidden");
    $("#logoutTop")?.classList.remove("hidden");

    const logoutBtn = $("#logoutTop");
    if (logoutBtn && !logoutBtn.dataset.listenerAdded) {
      logoutBtn.addEventListener("click", () => {
        localStorage.removeItem("jwtToken");
        localStorage.removeItem("currentUser");
        $("#dashboardCard")?.classList.add("hidden");
        $("#openLogin")?.classList.remove("hidden");
        $("#openSignup")?.classList.remove("hidden");
        $("#openDashboard")?.classList.add("hidden");
        logoutBtn.classList.add("hidden");
      });
      logoutBtn.dataset.listenerAdded = "true";
    }
  }

  // ---------- Auto-show dashboard if logged in ----------
  const savedUser = localStorage.getItem("currentUser");
  if (savedUser) {
    try { showUserDashboard(JSON.parse(savedUser)); }
    catch { localStorage.removeItem("currentUser"); }
  }

  // ---------- User Login ----------
const loginBtn = $("#loginSubmit");
if (loginBtn) loginBtn.addEventListener("click", async () => {
  const email = $("#liEmail")?.value;
  const password = $("#liPassword")?.value;
  if (!email || !password) return alert("Please enter email and password.");

  try {
    const res = await fetch(`${backendUrl}/api/auth/user-login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });
    const data = await res.json();
    if (data.token) {
    localStorage.setItem("token", data.token);
    }
    if (!res.ok || !data.success) throw new Error(data.message || "Login failed");

    // Terms required first
    if (data.requiresTerms) {
      localStorage.setItem("tempToken", data.tempToken);
      openModal("termsModal");
      closeModal("twoFAModal");
      return;
    }

    // 2FA required
    if (data.requires2FA) {
      localStorage.setItem("tempToken", data.tempToken);
      openModal("twoFAModal");
      return;
    }

    // If login has full data (no terms/2FA), fetch latest user
    const user = await fetchCurrentUser();
    if (user) showUserDashboard(user);

  } catch (err) {
    console.error(err);
    alert(err.message);
  }
});

// Accept Terms
document.addEventListener("click", async (e) => {
  if (e.target.id === "acceptTermsBtn") {
    const tempToken = localStorage.getItem("tempToken");
    if (!tempToken) return alert("No temp session found.");

    try {
      const res = await fetch(`${backendUrl}/api/auth/accept-terms`, {
        method: "POST",
        headers: { 
          "Content-Type": "application/json",
          "Authorization": `Bearer ${tempToken}`
        }
      });
      const data = await res.json();
      if (!res.ok || !data.success) throw new Error(data.message || "Could not accept terms");

      closeModal("termsModal");
      openModal("twoFAModal");
      startTwofaCountdown(300);
      alert("Terms accepted. Please enter 2FA code.");

    } catch (err) {
      console.error(err);
      alert(err.message);
    }
  }
});

// Verify 2FA
const verify2Btn = $("#verify2FABtn");
if (verify2Btn) verify2Btn.addEventListener("click", async () => {
  const code = $("#twofaCode")?.value;
  const tempToken = localStorage.getItem("tempToken");
  if (!code || !tempToken) return alert("Enter 2FA code.");

  try {
    const res = await fetch(`${backendUrl}/api/auth/verify-2fa`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ code, tempToken })
    });
    const data = await res.json();
    if (!res.ok || !data.success) throw new Error(data.message || "Invalid 2FA code");

    localStorage.setItem("jwtToken", data.authToken);
    localStorage.removeItem("tempToken");

    // ✅ Fetch latest user from backend
    const user = await fetchCurrentUser();
    if (user) showUserDashboard(user);

    closeModal("twoFAModal");

  } catch (err) {
    console.error(err);
    alert(err.message);
  }
});

// Fetch latest user
async function fetchCurrentUser() {
  const token = localStorage.getItem("jwtToken");
  if (!token) return null;

  try {
    const res = await fetch(`${backendUrl}/api/auth/current-user`, {
       headers: {
    "Content-Type": "application/json",
    "Authorization": `Bearer ${token}`
  },

    });
    if (!res.ok) return null;

    const result = await res.json();
    if (result.success) {
      localStorage.setItem("currentUser", JSON.stringify(result.user));
      return result.user;
    }
    return null;

  } catch (err) {
    console.error("Failed to fetch current user:", err);
    return null;
  }
}

let twofaTimer;
function startTwofaCountdown(seconds) {
  clearInterval(twofaTimer);
  const display = $("#countdown");
  let remaining = seconds;
  const updateDisplay = () => { 
    if (display) display.textContent = `${String(Math.floor(remaining / 60)).padStart(2,"0")}:${String(remaining % 60).padStart(2,"0")}`; 
  };
  updateDisplay();
  twofaTimer = setInterval(() => { 
    remaining--; 
    updateDisplay(); 
    if (remaining <= 0) clearInterval(twofaTimer); 
  }, 1000);
}
  
  // ---------- Admin Login ----------
  $("#openAdminLogin")?.addEventListener("click", () => openModal("adminLoginModal"));

  $("#adminLoginSubmit")?.addEventListener("click", async () => {
    localStorage.removeItem("adminToken"); localStorage.removeItem("currentAdmin");
    const email = $("#adminEmail")?.value.trim().toLowerCase();
    const password = $("#adminPassword")?.value.trim();
    if (!email || !password) return alert("Enter admin email & password");

    try {
      const res = await fetch(`${backendUrl}/api/auth/admin-login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
      });
      const data = await res.json();
      if (!res.ok || !data.success) throw new Error(data.message || "Invalid login");

      localStorage.setItem("adminToken", data.token);
      localStorage.setItem("currentAdmin", JSON.stringify(data.admin));
      closeModal("adminLoginModal");
      showAdminDashboard();
    } catch (err) { alert("Login failed: " + err.message); }
  });

  const adminAuthHeaders = () => ({
    "Content-Type": "application/json",
    "Authorization": `Bearer ${localStorage.getItem("adminToken") || ""}`
  });

  function showAdminDashboard() {
    $("#adminDashboard")?.classList.remove("hidden");
    loadAdminUsers();
    loadWithdrawals();
  }

  async function loadAdminUsers() {
  const tbody = document.getElementById("adminUsersBody");
  if (!tbody) return;
  tbody.innerHTML = `<tr><td colspan="7">Loading...</td></tr>`;

  try {
    const res = await fetch(`${backendUrl}/api/admin/users`, { headers: adminAuthHeaders() });
    const data = await res.json();
    const users = data.users || data;
    if (!Array.isArray(users)) throw new Error("Invalid users response");

    tbody.innerHTML = users.map(u => `
      <tr>
        <td>${u._id}</td>
        <td>${u.name}</td>
        <td>${u.email}</td>
        <td><input type="number" data-id="${u._id}" data-field="balance" value="${u.investment?.balance || 0}"></td>
        <td><input type="number" data-id="${u._id}" data-field="profit" value="${u.investment?.profit || 0}"></td>
        <td><input type="number" data-id="${u._id}" data-field="interest" value="${u.investment?.interest || 0}"></td>
        <td><button class="adminSave" data-id="${u._id}">Save</button></td>
      </tr>
    `).join("");
  } catch (err) {
    tbody.innerHTML = `<tr><td colspan="7">Error: ${err.message}</td></tr>`;
  }
}

// Combine ALL click logic into ONE listener
document.addEventListener("click", async (e) => {
  if (e.target.classList.contains("adminSave")) {
    const id = e.target.dataset.id;
    const row = e.target.closest("tr");

    // ✅ Safely parse numbers (default to 0 if empty/NaN)
    const balance = parseFloat(row.querySelector('input[data-field="balance"]')?.value) || 0;
    const profit = parseFloat(row.querySelector('input[data-field="profit"]')?.value) || 0;
    const interest = parseFloat(row.querySelector('input[data-field="interest"]')?.value) || 0;

    try {
      const res = await fetch(`${backendUrl}/api/admin/user/${id}/investment`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${localStorage.getItem("token")}`,
        },
        body: JSON.stringify({ balance, profit, interest }),
      });

      const data = await res.json();

      if (!res.ok) {
        throw new Error(data.message || "Failed to update investment");
      }

      alert("Investment updated successfully!");
    } catch (err) {
      console.error("Error updating investment:", err);
      alert("Error: " + err.message);
    }
  }



  // ---- Approve / Reject Withdrawal ----
  if (e.target.classList.contains("approveWd") || e.target.classList.contains("rejectWd")) {
    const id = e.target.dataset.id;
    const action = e.target.classList.contains("approveWd") ? "confirm" : "reject";

    try {
      const res = await fetch(`${backendUrl}/api/admin/withdrawals/${id}/${action}`, {
        method: "PUT",
        headers: adminAuthHeaders()
      });

      const data = await res.json();
      if (!res.ok || !data.success) throw new Error(data.message || "Action failed");

      alert(`Withdrawal ${action === "confirm" ? "approved" : "rejected"}!`);
      await loadWithdrawals(); // wait for table reload
    } catch (err) {
      alert("Error: " + err.message);
    }
  }
});

window.loadWithdrawals =  async function loadWithdrawals() {
    try {
      const token = localStorage.getItem("adminToken");
      if (!token) return alert("You must log in as admin first!");
      const tbody = document.querySelector("#withdrawalsTable tbody");
      if (!tbody) return console.error("No table found with ID 'withdrawalsTable'");
      const res = await fetch(`${backendUrl}/api/admin/withdrawals`, { headers: adminAuthHeaders() });
      const data = await res.json();
      const withdrawals = data.withdrawals || data;
      tbody.innerHTML = "";

      if (!withdrawals || withdrawals.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;">No withdrawals yet</td></tr>`;
        return;
      }

      withdrawals.forEach(w => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${w.user?.name || "Unknown"}</td>
          <td>${w.method}</td>
          <td>${w.amount}</td>
          <td>${w.status}</td>
          <td>
            <button class="approveWd" data-id="${w._id}">Approve</button>
            <button class="rejectWd" data-id="${w._id}">Reject</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

    } catch (err) { console.error("Error loading withdrawals:", err); }
  }

  $("#logoutAdmin")?.addEventListener("click", () => {
    localStorage.removeItem("adminToken"); localStorage.removeItem("currentAdmin");
    $("#adminDashboard")?.classList.add("hidden");
  });
});
document.querySelectorAll("[data-tab='withdrawalsTab']").forEach(btn => {
  btn.addEventListener("click", async () => {
    // Show withdrawals table section (if hidden)
    const withdrawalsSection = document.getElementById("withdrawalsSection");
    if (withdrawalsSection) withdrawalsSection.classList.remove("hidden");

    // Optionally hide other admin sections
    document.querySelectorAll(".adminTab").forEach(section => {
      if (section.id !== "withdrawalsSection") section.classList.add("hidden");
    });

    // Load the withdrawals from backend
    await loadWithdrawals();
  });
});

const socket = io("https://www.tradexinvest.net"); // adjust backend URL

// Listen for new withdrawals
socket.on("new-withdrawal", (data) => {
  alert(`New withdrawal request: $${data.amount} via ${data.method}`);
  // Optionally refresh your table
  loadWithdrawals();
});

// Listen for updates (approved/rejected)
socket.on("withdrawal-updated", (data) => {
  alert(`Withdrawal ${data.id} updated: ${data.status}`);
  loadWithdrawals();
});
function adminAuthHeaders() {
  const token = localStorage.getItem("adminToken");
  if (!token) {
    alert("Admin not logged in!");
    return {};
  }
  return {
    "Content-Type": "application/json",
    "Authorization": `Bearer ${token}`
  };
}
// Load investment table
// Load investment table and update dashboard stats
async function loadInvestments(userId) {
  try {
    const res = await fetch(`${backendUrl}/user/${userId}/investments`, {
      headers: adminAuthHeaders()
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.message || "Failed to fetch investments");

    // ----- Update Investment Table -----
    const tbody = document.getElementById("investmentsBody");
    tbody.innerHTML = "";

    data.investments.forEach(inv => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>$${inv.amount.toFixed(2)}</td>
        <td>${inv.method}</td>
        <td>${new Date(inv.date).toLocaleDateString()}</td>
      `;
      tbody.appendChild(tr);
    });

    // ----- Update Dashboard Stats -----
    // Here we pass a user-like object with investments
    hydrateStatsFromUser({ investments: data.investments });

  } catch (err) {
    console.error("Error loading investments:", err);
  }
}

// Delete investment
async function deleteInvestment(id) {
  if (!confirm("Are you sure?")) return;
  const res = await fetch(`${backendUrl}/api/admin/investments/${id}`, {
    method: "DELETE",
    headers: adminAuthHeaders()
  });
  const data = await res.json();
  if (data.success) loadInvestments();
}


// Add investment
document.getElementById("addInvestmentForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  
  const userId = document.getElementById("investmentUserId").value;
  const amount = parseFloat(document.getElementById("investmentAmount").value);
  const method = document.getElementById("investmentMethod").value;
  const date = document.getElementById("investmentDate").value;

  if (!userId || !amount || !method || !date) {
    return alert("All fields are required.");
  }

  try {
    const res = await fetch(`${backendUrl}/api/admin/user/${userId}/investment`, {
      method: "PUT",
      headers: adminAuthHeaders(),
      body: JSON.stringify({ amount, method, date })
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.message || "Failed to add investment");

    alert(`Investment added: $${amount}`);
    loadInvestments(userId); // Reload table
  } catch (err) {
    console.error("Error adding investment:", err);
    alert("Error adding investment: " + err.message);
  }
});
</script>
  
</body>
</html>