<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>User Login - TradexInvest</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    /* (styles kept similar to your earlier design) */
body { font-family: Arial; display:flex; justify-content:center; align-items:center; height:100vh; background-color: rgba(0, 0, 255, 0.479); }
.login-box { padding:20px; border:1px solid #ccc; border-radius:8px; width:300px; }
input { width:100%; padding:8px; margin:5px 0; }
button { width:100%; padding:8px; margin-top:10px; cursor:pointer; }
.popup { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
        background:#fff; border:1px solid #ccc; padding:20px; z-index:1000; width:300px; border-radius:8px; }
.popup h3 { margin-top:0; }
  </style>
</head>
<body>
<h2>WELCOME TO TradeXInvest</h2>
  <div class="login-box">
<h2>Login</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button id="loginBtn">Login</button>
</div>
<div id="termsPopup" class="popup">
<h3>Terms & Conditions</h3>
p>Welcome to TradexInvest. By using our services, you agree to the following terms:</p>
    
    <h3>1. Security Features</h3>
    <ul>
      <li><strong>Two-Factor Authentication (2FA):</strong> We provide 2FA for additional security. It is strongly recommended to enable it for your account.</li>
      <li><strong>Cold Storage:</strong> The majority of user digital assets are stored in cold storage to protect against online threats.</li>
      <li><strong>Encryption:</strong> All sensitive user data is encrypted both in transit and at rest.</li>
    </ul>

    <h3>2. Fee Structure</h3>
    <ul>
      <li>Deposit Fee: <strong>0%</strong></li>
      <li>Withdrawal Fee: <strong>1.5%</strong> of the transaction amount</li>
      <li>Trading Fee: <strong>0.25%</strong> per executed trade</li>
      <li>Other network or blockchain fees may apply where relevant.</li>
    </ul>

    <h3>3. Risk Disclosure</h3>
    <p>Investing in digital assets involves high risk, including the potential loss of your entire investment. Prices are volatile and may be affected by external factors such as market trends, regulations, or technological changes. Past performance is not indicative of future results. You are solely responsible for your investment decisions.</p>

    <h3>4. User Agreement</h3>
    <p>By continuing, you acknowledge that you have read, understood, and agree to these Terms & Conditions. You also agree to our Privacy Policy and any updates that may occur.</p>

<p>Please accept our terms to continue.</p>
<button id="acceptTermsBtn">Accept</button>
</div>

  

 <div id="twoFAPopup" class="popup">
  <h3>2FA Verification</h3>
  <input type="text" id="twoFAInput" placeholder="Enter 2FA code">
  <button id="verify2FABtn">Verify</button>
  <button id="resend2FABtn">Resend Code</button>
  <p id="countdown"></p>
</div>

    
<script>
const backendUrl = "https://tradexinvestments.onrender.com"; // adjust to your backend

// Login function
async function loginUser(email, password) {
  try {
    const res = await fetch(`${backendUrl}/api/auth/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.msg || "Login failed");

    localStorage.setItem("currentUser", JSON.stringify(data));

    // Show terms popup first
    showTermsPopup();
  } catch (err) {
    alert(err.message);
  }
}

// Terms & Conditions popup
function showTermsPopup() {
  const termsPopup = document.getElementById("termsPopup");
  termsPopup.style.display = "block";

  document.getElementById("acceptTermsBtn").onclick = () => {
    localStorage.setItem("termsAccepted", "true");
    termsPopup.style.display = "none";

    // Show 2FA next
    show2FAPopup();
  };
}

// 2FA popup
let countdownTimer;
function show2FAPopup() {
  const popup = document.getElementById("twoFAPopup");
  popup.style.display = "block";
  startCountdown();

  document.getElementById("verify2FABtn").onclick = async () => {
    const code = document.getElementById("twoFAInput").value;
    const user = JSON.parse(localStorage.getItem("currentUser"));
    try {
      const res = await fetch(`${backendUrl}/api/auth/verify-2fa`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email: user.email, code })
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.msg);

      localStorage.setItem("twoFAVerified", "true");
      localStorage.setItem("jwtToken", data.token);
      popup.style.display = "none";
      clearInterval(countdownTimer);

      // Redirect dynamically
      if (user.email.toLowerCase() === "youngnazzy13@gmail.com") {
        window.location.href = "admin.html";
      } else {
        window.location.href = "index.html";
      }

    } catch (err) {
      alert(err.message);
    }
  };

  document.getElementById("resend2FABtn").onclick = async () => {
    const user = JSON.parse(localStorage.getItem("currentUser"));
    try {
      const res = await fetch(`${backendUrl}/api/auth/resend-2fa`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email: user.email })
      });
      const data = await res.json();
      alert(data.msg);
      startCountdown();
    } catch (err) {
      alert(err.message);
    }
  };
}

// Countdown timer
function startCountdown(duration = 300) { // 5 minutes
  clearInterval(countdownTimer);
  const countdownEl = document.getElementById("countdown");
  let timeLeft = duration;

  countdownEl.textContent = `Code expires in: ${formatTime(timeLeft)}`;
  countdownTimer = setInterval(() => {
    timeLeft--;
    countdownEl.textContent = `Code expires in: ${formatTime(timeLeft)}`;
    if (timeLeft <= 0) {
      clearInterval(countdownTimer);
      countdownEl.textContent = "Code expired. Please resend.";
    }
  }, 1000);
}

function formatTime(seconds) {
  const min = Math.floor(seconds / 60);
  const sec = seconds % 60;
  return `${min}:${sec < 10 ? "0" + sec : sec}`;
}

// Render dashboard dynamically on index.html
function showUserDashboard(user) {
  // Hide login or popups
  document.getElementById("loginForm")?.remove();
  document.getElementById("twoFAPopup")?.remove();
  document.getElementById("termsPopup")?.remove();

  const dashboard = document.getElementById("dashboard") || document.createElement("div");
  dashboard.id = "dashboard";
  dashboard.innerHTML = `
    <h2>Welcome, ${user.name}</h2>
    ${user.photo ? `<img src="${backendUrl}${user.photo}" alt="Profile" width="100">` : ""}
    <p>Email: ${user.email}</p>
    <button id="logoutBtn">Logout</button>
  `;
  document.body.appendChild(dashboard);

  document.getElementById("logoutBtn").onclick = () => {
    localStorage.removeItem("currentUser");
    localStorage.removeItem("twoFAVerified");
    localStorage.removeItem("termsAccepted");
    window.location.reload(); // back to login
  };
}

// On index.html load, check if user already logged in
document.addEventListener("DOMContentLoaded", () => {
  const user = JSON.parse(localStorage.getItem("currentUser"));
  const twoFAVerified = localStorage.getItem("twoFAVerified");
  if (user && twoFAVerified === "true" && window.location.pathname.endsWith("index.html")) {
    showUserDashboard(user);
  }
});
</script>



  




  
</body>
</html>

   